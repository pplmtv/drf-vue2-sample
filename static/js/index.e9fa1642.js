(function(e){function t(t){for(var o,n,i=t[0],c=t[1],l=t[2],m=0,f=[];m<i.length;m++)n=i[m],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&f.push(r[n][0]),r[n]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);u&&u(t);while(f.length)f.shift()();return a.push.apply(a,l||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],o=!0,i=1;i<s.length;i++){var c=s[i];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=n(n.s=s[0]))}return e}var o={},r={index:0},a=[];function n(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=o,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/static/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),r=s("5f5b"),a=(s("f9e3"),s("2dd8"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)}),n=[],i=(s("034f"),s("2877")),c={},l=Object(i["a"])(c,a,n,!1,null,null,null),u=l.exports,m=(s("d3b7"),s("ac1f"),s("5319"),s("8c4f")),f=s("2f62"),p=(s("99af"),s("07ac"),s("bc3a")),g=s.n(p),d=g.a.create({baseURL:"/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});d.interceptors.request.use((function(e){console.log("message clear."),console.log("process.env.VUE_APP_ROOT_API","/api/v1/"),_.dispatch("message/clearMessages");var t=localStorage.getItem("access");return t?(e.headers.Authorization="JWT "+t,e):e}),(function(e){return Promise.reject(e)})),d.interceptors.response.use((function(e){return console.log("DEBUG api.interceptors.response.use"),console.log("status:",e.status),e}),(function(e){console.log("error.response=",e.response);var t,s=e.response?e.response.status:500;if(400===s){var o=[].concat.apply([],Object.values(e.response.data));_.dispatch("message/setWarningMessages",{messages:o})}else if(401===s){var r=localStorage.getItem("access");t=null!=r?"ログイン有効期限切れ":"認証エラー",_.dispatch("auth/logout"),_.dispatch("message/setErrorMessage",{message:t})}else 403===s?(t="権限エラーです。",_.dispatch("message/setErrorMessage",{message:t})):(t="想定外のエラーです",_.dispatch("message/setErrorMessage",{message:t}));return Promise.reject(e)}));var h=d;o["default"].use(f["a"]);var v={namespaced:!0,state:{username:"",isLoggedIn:!1},mutations:{set:function(e,t){e.username=t.user.username,e.isLoggedIn=!0},clear:function(e){e.username="",e.isLoggedIn=!1}},actions:{login:function(e,t){return h.post("/auth/jwt/create/",{username:t.username,password:t.password}).then((function(t){return localStorage.setItem("access",t.data.access),e.dispatch("renew")}))},logout:function(e){localStorage.removeItem("access"),e.commit("clear")},renew:function(e){return h.get("/auth/users/me/").then((function(t){var s=t.data;e.commit("set",{user:s})}))}}},b={namespaced:!0,state:{error:"",warnings:[],info:""},mutations:{set:function(e,t){t.error&&(e.error=t.error),t.warnings&&(e.warnings=t.warnings),t.info&&(e.info=t.info)},clear:function(e){e.error="",e.warnings=[],e.info=""}},actions:{setErrorMessage:function(e,t){e.commit("clear"),e.commit("set",{error:t.message})},setWarningsMessage:function(e,t){e.commit("clear"),e.commit("set",{warnings:t.messages})},setInfoMessage:function(e,t){e.commit("clear"),e.commit("set",{info:t.message})},clearMessages:function(e){e.commit("clear")}}},w=new f["a"].Store({modules:{auth:v,message:b}}),_=w,y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"home-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container mt-5 p-5"},[s("p",{staticClass:"h5 mb-5"},[e._v("ホーム")]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitSave.apply(null,arguments)}}},[s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("タイトル")]),s("div",{staticClass:"col-sm-8"},[s("b-input",{staticClass:"form-control",attrs:{type:"text"},model:{value:e.form.book.title,callback:function(t){e.$set(e.form.book,"title",t)},expression:"form.book.title"}})],1)]),s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("価格")]),s("div",{staticClass:"col-sm-8"},[s("b-input",{staticClass:"form-control",attrs:{type:"text"},model:{value:e.form.book.price,callback:function(t){e.$set(e.form.book,"price",t)},expression:"form.book.price"}})],1)]),s("div",{staticClass:"row text-center mt-5"},[s("div",{staticClass:"col-sm-12"},[s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v(" "+e._s(e.isCreated?"更新":"登録")+" ")])],1)])])],1),s("div",{staticClass:"m-5"},[s("pre",[e._v("form: "+e._s(e.form))]),s("pre",[e._v("state: "+e._s(this.$store.state))])])],1)},C=[],k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"header"}},[s("b-navbar",{attrs:{type:"dark",variant:"dark"}},[s("a",{staticClass:"navbar-brand",attrs:{href:"/"}},[e._v("DRF Sample")]),e.$route.meta.requiresAuth?s("b-navbar-nav",{staticClass:"ml-auto"},[e.isLoggedIn?s("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v(e._s(e.username))]},proxy:!0}],null,!1,1662484308)},[s("b-dropdown-item",{attrs:{href:"#"},on:{click:e.clickLogout}},[e._v(" ログアウト ")])],1):s("b-nav-item",{attrs:{href:"# v-on:click=clickLogin"}},[e._v(" ログイン ")])],1):e._e()],1)],1)},x=[],$={computed:{username:function(){return this.$store.state.auth.username},isLoggedIn:function(){return this.$store.state.auth.isLoggedIn}},methods:{clickLogout:function(){this.$store.dispatch("auth/logout"),this.$store.dispatch("message/setInfoMessage",{message:"ログアウトしました。"}),this.$router.replace("/login")},clickLogin:function(){this.$store.dispatch("message/clearMessages"),this.$router.replace("/login")}}},M=$,j=Object(i["a"])(M,k,x,!1,null,null,null),E=j.exports,O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"messages"}},[s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.error,expression:"message.error"}],staticClass:"mb-0",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.message.error)+" ")]),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.warnings.length,expression:"message.warnings.length"}],attrs:{variant:"warning",show:""}},[e._v(' 0" class="mb-0" > '),e._l(e.message.warnings,(function(t){return s("p",{key:t,staticClass:"mb-0"},[e._v(" "+e._s(t)+" ")])}))],2),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.info,expression:"message.info"}],staticClass:"mb-0",attrs:{variant:"info",show:""}},[e._v(" "+e._s(e.message.info)+" ")])],1)},S=[],I={computed:{message:function(){return this.$store.state.message}}},L=I,G=Object(i["a"])(L,O,S,!1,null,null,null),P=G.exports,q={components:{GlobalHeader:E,GlobalMessage:P},data:function(){return{form:{book:{title:"",price:0}}}},computed:{isCreated:function(){return void 0!==this.form.book.id}},methods:{submitSave:function(){var e=this;console.log("create or update."),console.log("DEBUG START."),g.a.get("http://127.0.0.1:8000/api/v1/books/").then((function(e){console.log("DEBUG axios get success."),console.log("status:",e.status)})).catch((function(e){console.log("axiosGetErr",e)})),g.a.post("http://127.0.0.1:8000/api/v1/books/",{title:"urasima tarou",price:2e3,created_at:"2021-12-07T06:41:56.325618+09:00"}).then((function(e){console.log("DEBUG axios post success."),console.log("status:",e.status)})).catch((function(e){console.log("axiosGetErr",e)})).finally((function(){console.log("DEBUG END.")})),h({method:this.isCreated?"put":"post",url:this.isCreated?"/books/"+this.form.book.id+"/":"/books/",data:{id:this.form.book.id,title:this.form.book.title,price:this.form.book.price}}).then((function(t){var s=e.isCreated?"更新しました。":"登録しました。";e.$store.dispatch("message/setInfoMessage",{message:s}),e.form.book=t.data}))}}},T=q,D=Object(i["a"])(T,y,C,!1,null,null,null),U=D.exports,A=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"login-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container mt-5 p-5"},[s("p",{staticClass:"h5 mb-5"},[e._v("ログイン")]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitLogin.apply(null,arguments)}}},[s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("ユーザー名")]),s("div",{staticClass:"col-sm-8"},[s("b-input",{attrs:{type:"text",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)]),s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("パスワード")]),s("div",{staticClass:"col-sm-8"},[s("b-input",{attrs:{type:"password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)]),s("div",{staticClass:"row text-center mt-5"},[s("div",{staticClass:"col-sm-12"},[s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("ログイン")])],1)])])],1),s("div",{staticClass:"m-5"},[s("pre",[e._v("form: "+e._s(e.form))]),s("pre",[e._v("state: "+e._s(this.$store.state))])])],1)},R=[],B={components:{GlobalHeader:E,GlobalMessage:P},data:function(){return{form:{username:"",password:""}}},methods:{submitLogin:function(){var e=this;console.log("Login execute."),this.$store.dispatch("auth/login",{username:this.form.username,password:this.form.password}).then((function(){console.log("Login succeeded."),e.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});var t=e.$route.query.next||"/";e.$router.replace(t)}))}}},H=B,N=Object(i["a"])(H,A,R,!1,null,null,null),W=N.exports;o["default"].use(m["a"]);var J=[{path:"/",component:U,meta:{requiresAuth:!0}},{path:"/login",component:W},{path:"/:cacheAll(.*)",redirect:"/"}],F=new m["a"]({mode:"history",routes:J});function X(e){console.log("Force to login page."),F.replace({path:"/login",query:{next:e.fullPath}})}F.beforeEach((function(e,t,s){var o=_.state.auth.isLoggedIn,r=localStorage.getItem("access"),a=e.matched.some((function(e){return e.meta.requiresAuth}));console.log("isLoggedIn=",o),a?o?(console.log("User is already logged in. So, free to next."),s()):(console.log("User is not logged in."),null!=r?(console.log("Try to renew user info"),_.dispatch("auth/renew").then((function(){console.log("Succeeded to renew. So, free to next."),s()})).catch((function(){X(e)}))):X(e)):(console.log("Go to public page."),s())}));var z=F;o["default"].config.productionTip=!1,o["default"].use(r["a"]),new o["default"]({router:z,store:_,render:function(e){return e(u)}}).$mount("#app")},"85ec":function(e,t,s){}});
//# sourceMappingURL=index.e9fa1642.js.map